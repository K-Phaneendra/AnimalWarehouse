import React from 'react';
import { connect } from 'react-redux';
import TextField from '../../components/TextField/TextField';
import Button from '../../components/Button/Button';
import { submitLogin } from '../../actions/LoginAction';

class Login extends React.Component {
  constructor() {
    super();
    this.state = {
      email: '',
      password: '',
      disabled: true,
      diplayMsg: ''
    };
  }
  checkDisabled = name => e => {
    this.setState({ [name]: e.target.value });
    if (e.target.value === '') {
      this.setState({ disabled: true });
    }
  };

  submitLogin = () => {
    const loginObj = { email: this.state.email, password: this.state.password };
    this.props.dispatch(submitLogin(loginObj, this.loginFailed));
  };
  loginFailed = result => {
    this.setState({
      // open: true,
      // snackbarMsg: 'Oops.. verification failed, Pls contact your admin'
      diplayMsg: result.message
    });
  };
  render() {
    const state = { ...this.state };
    if (state.email !== '' && state.password !== '') {
      state.disabled = false;
    }
    const props = { ...this.props };
    if (props.loggedInUser !== null) {
      this.props.router.push('/');
    }
    return (
      <div>
        <form>
          <TextField label="E-mail" onChange={this.checkDisabled('email')} />
          <TextField
            label="Password"
            type="Password"
            onChange={this.checkDisabled('password')}
          />
          <span>new here?</span>
          <Button value="Sign up" disabled={false} href="#registration" />
          <Button
            value="Login"
            disabled={state.disabled}
            onClick={this.submitLogin}
          />
        </form>
        <div>{this.state.diplayMsg}</div>
      </div>
    );
  }
}

function mapStateToProps(state) {
  return {
    loggedInUser: state.login.loggedInUser
  };
}

export default connect(mapStateToProps)(Login);
