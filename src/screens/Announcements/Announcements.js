import React, { Component } from 'react';
import { connect } from 'react-redux';
import { Row, Col } from 'react-bootstrap';
import DashboardToggleView from '../Dashboard/dashboardToggleView';
// import AnnouncementFormsView from './AnnouncementFormsView';
import { fetchAnimals } from '../../actions/animalActions';
import AnnouncementsTableView from './AnnouncementsTableView';
import { handleSnackBar } from '../../actions/DashboardAction';
import { SnackBar } from '../../components/SnackBar';
import AnnouncementGridView from './AnnouncementsGridView';

class Announcements extends Component {
  constructor() {
    super();
    this.state = {
      openCreateAnnouncement: false
    };
  }
  componentDidMount() {
    this.props.dispatch(fetchAnimals());
  }
  changeParentState = obj => {
    Object.keys(obj).map(key => {
      const obtainedKey = key;
      this.setState({ [obtainedKey]: obj[key] });
      return null;
    });
  };
  render() {
    const {
      loggedInUser,
      currentView,
      animalSpecies,
      attributes,
      announcements
    } = this.props;
    const { openCreateAnnouncement } = this.state;
    const tileView = currentView === 'tileView';
    const tableView = currentView === 'tableView';
    return (
      <div className="position-search-wrap">
        <div className="browse-wrap">
          <Row className="padding-top">
            <Col lg={6} md={6} sm={6} className="action-wrap">
              <ul className="action-buttons">
                <li>
                  <i
                    className="fas fa-plus"
                    aria-hidden="true"
                    onClick={() =>
                      this.setState({ openCreateAnnouncement: true })
                    }
                    title="Create Announcement"
                  />
                </li>
              </ul>
            </Col>
            <Col lg={6} md={6} sm={6}>
              <DashboardToggleView />
            </Col>
          </Row>
          <div className="grid-view">
            {tileView ? (
              // <AnnouncementFormsView
              //   animalSpecies={animalSpecies}
              //   attributes={attributes}
              // />
              <AnnouncementGridView announcements={announcements} />
            ) : (
              ''
            )}
            {tableView ? (
              <AnnouncementsTableView
                loggedInUser={loggedInUser}
                animalSpecies={animalSpecies}
                attributes={attributes}
                announcements={announcements}
                openCreateAnnouncement={openCreateAnnouncement}
                changeParentState={obj => this.changeParentState(obj)}
              />
            ) : (
              ''
            )}
          </div>
        </div>
        <SnackBar
          open={this.props.snackBarOpen}
          onClose={() =>
            this.props.dispatch(
              handleSnackBar({ snackBarOpen: false, snackBarMsg: '' })
            )
          }
          msg={this.props.snackBarMsg}
        />
      </div>
    );
  }
}

const mapStateToProps = state => ({
  loggedInUser: state.login.loggedInUser,
  currentView: state.dashboard.currentView,
  animalSpecies: state.animalsReducer.animalSpecies,
  attributes: state.animalsReducer.attributes,
  snackBarOpen: state.dashboard.snackBarOpen,
  snackBarMsg: state.dashboard.snackBarMsg,
  announcements: state.animalsReducer.announcements
});

export default connect(mapStateToProps)(Announcements);
